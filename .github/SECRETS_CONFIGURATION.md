# üîê Configura√ß√£o de Secrets - GitHub Actions

## üìã Vis√£o Geral

Este documento descreve como configurar os secrets necess√°rios para os GitHub Actions do projeto WebDi√°rio Platform, incluindo credenciais para DockerHub, Grafana, AWS e GCP.

## üéØ Secrets Necess√°rios

### üê≥ **DockerHub Secrets**

#### `DOCKERHUB_USERNAME`
- **Descri√ß√£o**: Nome de usu√°rio do DockerHub
- **Tipo**: String
- **Exemplo**: `webdiario`
- **Obrigat√≥rio**: ‚úÖ Sim
- **Uso**: Login no DockerHub para push das imagens

#### `DOCKERHUB_TOKEN`
- **Descri√ß√£o**: Token de acesso do DockerHub (n√£o a senha)
- **Tipo**: String (Access Token)
- **Exemplo**: `dckr_pat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
- **Obrigat√≥rio**: ‚úÖ Sim
- **Uso**: Autentica√ß√£o para push das imagens

**Como obter o token:**
1. Acesse [DockerHub](https://hub.docker.com/)
2. V√° em **Account Settings** ‚Üí **Security**
3. Clique em **New Access Token**
4. D√™ um nome descritivo (ex: "GitHub Actions WebDi√°rio")
5. Selecione as permiss√µes necess√°rias (Read, Write, Delete)
6. Copie o token gerado

### üìä **Grafana Secrets**

#### `GRAFANA_ADMIN_USER`
- **Descri√ß√£o**: Usu√°rio administrador do Grafana
- **Tipo**: String
- **Exemplo**: `admin`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para configura√ß√µes espec√≠ficas)
- **Uso**: Configura√ß√£o de dashboards e alertas

#### `GRAFANA_ADMIN_PASSWORD`
- **Descri√ß√£o**: Senha do administrador do Grafana
- **Tipo**: String (senha segura)
- **Exemplo**: `GrafanaSecurePass123!`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para configura√ß√µes espec√≠ficas)
- **Uso**: Configura√ß√£o de dashboards e alertas

#### `GRAFANA_API_KEY`
- **Descri√ß√£o**: Chave API do Grafana para automa√ß√£o
- **Tipo**: String (API Key)
- **Exemplo**: `eyJrIjoiR0ZXZmtqUFJkUjNxS0E3eFJ6dHoxM2lKZ0x6VzEiLCJuIjoiZ2l0aHViLWFjdGlvbnMiLCJpZCI6MX0=`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para automa√ß√£o avan√ßada)
- **Uso**: Configura√ß√£o autom√°tica de dashboards

**Como obter a API Key:**
1. Acesse o Grafana (http://localhost:3000)
2. V√° em **Configuration** ‚Üí **API Keys**
3. Clique em **New API Key**
4. D√™ um nome descritivo
5. Selecione as permiss√µes (Admin, Editor, Viewer)
6. Copie a chave gerada

### ‚òÅÔ∏è **AWS Secrets**

#### `AWS_ACCESS_KEY_ID`
- **Descri√ß√£o**: Chave de acesso AWS
- **Tipo**: String (Access Key ID)
- **Exemplo**: `AKIAIOSFODNN7EXAMPLE`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para integra√ß√£o AWS)
- **Uso**: Autentica√ß√£o com servi√ßos AWS

#### `AWS_SECRET_ACCESS_KEY`
- **Descri√ß√£o**: Chave secreta AWS
- **Tipo**: String (Secret Access Key)
- **Exemplo**: `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para integra√ß√£o AWS)
- **Uso**: Autentica√ß√£o com servi√ßos AWS

#### `AWS_DEFAULT_REGION`
- **Descri√ß√£o**: Regi√£o padr√£o AWS
- **Tipo**: String
- **Exemplo**: `us-east-1`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para integra√ß√£o AWS)
- **Uso**: Configura√ß√£o de regi√£o para servi√ßos AWS

**Como obter as credenciais AWS:**
1. Acesse o [AWS Console](https://console.aws.amazon.com/)
2. V√° em **IAM** ‚Üí **Users** ‚Üí **Create User**
3. Selecione **Programmatic access**
4. Anexe pol√≠ticas necess√°rias (ex: `AmazonEC2ContainerRegistryFullAccess`)
5. Copie o **Access Key ID** e **Secret Access Key**

### üåê **GCP Secrets**

#### `GCP_PROJECT_ID`
- **Descri√ß√£o**: ID do projeto Google Cloud
- **Tipo**: String
- **Exemplo**: `webdiario-platform-123456`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para integra√ß√£o GCP)
- **Uso**: Identifica√ß√£o do projeto GCP

#### `GCP_SERVICE_ACCOUNT_KEY`
- **Descri√ß√£o**: Chave da service account GCP (JSON)
- **Tipo**: String (JSON completo)
- **Exemplo**: `{"type": "service_account", "project_id": "webdiario-platform-123456", ...}`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para integra√ß√£o GCP)
- **Uso**: Autentica√ß√£o com servi√ßos GCP

#### `GCP_REGION`
- **Descri√ß√£o**: Regi√£o padr√£o GCP
- **Tipo**: String
- **Exemplo**: `us-central1`
- **Obrigat√≥rio**: ‚ö†Ô∏è Opcional (para integra√ß√£o GCP)
- **Uso**: Configura√ß√£o de regi√£o para servi√ßos GCP

**Como obter as credenciais GCP:**
1. Acesse o [Google Cloud Console](https://console.cloud.google.com/)
2. V√° em **IAM & Admin** ‚Üí **Service Accounts**
3. Clique em **Create Service Account**
4. D√™ um nome e descri√ß√£o
5. Anexe as roles necess√°rias (ex: `Container Registry Service Agent`)
6. Clique em **Create Key** ‚Üí **JSON**
7. Baixe o arquivo JSON e copie o conte√∫do

## üöÄ Como Configurar os Secrets

### üìù **Via GitHub Web Interface**

1. **Acesse o reposit√≥rio** no GitHub
2. V√° em **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. Clique em **New repository secret**
4. Digite o **Name** (ex: `DOCKERHUB_USERNAME`)
5. Digite o **Secret** (ex: `webdiario`)
6. Clique em **Add secret**
7. Repita para todos os secrets necess√°rios

### üîß **Via GitHub CLI**

```bash
# Instalar GitHub CLI (se n√£o tiver)
# https://cli.github.com/

# Fazer login
gh auth login

# Adicionar secrets
gh secret set DOCKERHUB_USERNAME --body "webdiario"
gh secret set DOCKERHUB_TOKEN --body "dckr_pat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
gh secret set GRAFANA_ADMIN_USER --body "admin"
gh secret set GRAFANA_ADMIN_PASSWORD --body "GrafanaSecurePass123!"
gh secret set AWS_ACCESS_KEY_ID --body "AKIAIOSFODNN7EXAMPLE"
gh secret set AWS_SECRET_ACCESS_KEY --body "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
gh secret set AWS_DEFAULT_REGION --body "us-east-1"
gh secret set GCP_PROJECT_ID --body "webdiario-platform-123456"
gh secret set GCP_SERVICE_ACCOUNT_KEY --body '{"type": "service_account", "project_id": "webdiario-platform-123456", ...}'
gh secret set GCP_REGION --body "us-central1"
```

### üè¢ **Para Organiza√ß√µes**

Se o reposit√≥rio pertence a uma organiza√ß√£o, voc√™ pode configurar secrets a n√≠vel de organiza√ß√£o:

1. V√° para a **organiza√ß√£o** no GitHub
2. Clique em **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. Clique em **New organization secret**
4. Configure os secrets que ser√£o compartilhados entre reposit√≥rios

## üîí **Boas Pr√°ticas de Seguran√ßa**

### ‚úÖ **Recomenda√ß√µes**

1. **Use tokens espec√≠ficos**: Crie tokens com permiss√µes m√≠nimas necess√°rias
2. **Rotacione credenciais**: Mude senhas e tokens regularmente
3. **Monitore acesso**: Revise logs de acesso periodicamente
4. **Use vari√°veis de ambiente**: N√£o hardcode credenciais no c√≥digo
5. **Limite escopo**: Use secrets apenas quando necess√°rio
6. **Audite permiss√µes**: Revise permiss√µes de tokens regularmente

### ‚ùå **Evite**

1. **Compartilhar credenciais**: Nunca compartilhe secrets via chat/email
2. **Usar credenciais pessoais**: Use contas de servi√ßo dedicadas
3. **Permiss√µes excessivas**: N√£o d√™ mais permiss√µes que o necess√°rio
4. **Logs de credenciais**: Nunca fa√ßa log de secrets
5. **Commits com credenciais**: Nunca commite credenciais no c√≥digo

## üß™ **Testando a Configura√ß√£o**

### üîç **Verificar Secrets**

```bash
# Listar secrets configurados
gh secret list

# Verificar se um secret espec√≠fico existe
gh secret get DOCKERHUB_USERNAME
```

### üê≥ **Testar DockerHub**

```bash
# Testar login no DockerHub
echo $DOCKERHUB_TOKEN | docker login --username $DOCKERHUB_USERNAME --password-stdin

# Testar push de uma imagem
docker tag test-image $DOCKERHUB_USERNAME/test-image:latest
docker push $DOCKERHUB_USERNAME/test-image:latest
```

### ‚òÅÔ∏è **Testar AWS**

```bash
# Configurar credenciais AWS
export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
export AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION

# Testar conex√£o
aws sts get-caller-identity
```

### üåê **Testar GCP**

```bash
# Configurar credenciais GCP
echo $GCP_SERVICE_ACCOUNT_KEY > gcp-key.json
export GOOGLE_APPLICATION_CREDENTIALS=gcp-key.json

# Testar conex√£o
gcloud auth list
gcloud config get-value project
```

## üÜò **Troubleshooting**

### ‚ùì **Problemas Comuns**

**Problema**: Erro de autentica√ß√£o DockerHub
**Solu√ß√£o**: 
- Verifique se o token est√° correto
- Confirme se o usu√°rio tem permiss√µes de push
- Teste o login manualmente

**Problema**: Erro de permiss√µes AWS
**Solu√ß√£o**:
- Verifique se as credenciais est√£o corretas
- Confirme se o usu√°rio tem as pol√≠ticas necess√°rias
- Teste com `aws sts get-caller-identity`

**Problema**: Erro de autentica√ß√£o GCP
**Solu√ß√£o**:
- Verifique se o JSON da service account est√° correto
- Confirme se a service account tem as roles necess√°rias
- Teste com `gcloud auth list`

**Problema**: Secrets n√£o encontrados no workflow
**Solu√ß√£o**:
- Verifique se os nomes dos secrets est√£o corretos
- Confirme se os secrets est√£o configurados no reposit√≥rio
- Verifique se o workflow tem permiss√µes para acessar secrets

### üîß **Comandos de Diagn√≥stico**

```bash
# Verificar status dos workflows
gh run list

# Ver logs de um workflow espec√≠fico
gh run view [RUN_ID]

# Ver secrets configurados
gh secret list

# Testar conex√µes
docker login --username $DOCKERHUB_USERNAME --password $DOCKERHUB_TOKEN
aws sts get-caller-identity
gcloud auth list
```

## üìä **Monitoramento**

### üìà **M√©tricas Importantes**

1. **Taxa de sucesso dos builds**: Monitore falhas de build
2. **Tempo de build**: Otimize builds lentos
3. **Uso de recursos**: Monitore consumo de CPU/mem√≥ria
4. **Logs de seguran√ßa**: Revise tentativas de acesso
5. **Rota√ß√£o de credenciais**: Mantenha credenciais atualizadas

### üö® **Alertas Recomendados**

1. **Falhas de build**: Notificar sobre builds que falharam
2. **Tentativas de acesso suspeitas**: Alertar sobre acessos an√¥malos
3. **Credenciais expiradas**: Notificar sobre tokens pr√≥ximos do vencimento
4. **Uso excessivo de recursos**: Alertar sobre consumo alto

## üîó **Links √öteis**

- **GitHub Secrets**: [Documenta√ß√£o](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- **DockerHub Tokens**: [Criar Access Token](https://hub.docker.com/settings/security)
- **AWS IAM**: [Gerenciar Usu√°rios](https://console.aws.amazon.com/iam/)
- **GCP Service Accounts**: [Criar Service Account](https://console.cloud.google.com/iam-admin/serviceaccounts)
- **Grafana API Keys**: [Gerenciar API Keys](http://localhost:3000/org/apikeys)

---

**üìù √öltima Atualiza√ß√£o**: Janeiro 2025  
**üë®‚Äçüíª Respons√°vel**: Equipe de Desenvolvimento WebDi√°rio  
**üèóÔ∏è Projeto**: WebDi√°rio Platform - GitHub Actions  
**üéØ Status**: ‚úÖ **CONFIGURA√á√ÉO COMPLETA**
